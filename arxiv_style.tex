%\usepackage{geometry}
\usepackage[letterpaper, left=1in, right=1in, top=1in, bottom=1in]{geometry}

\PassOptionsToPackage{hypertexnames=false}{hyperref}  % compatible with cref for multiple algo
\usepackage{parskip}

\usepackage[dvipsnames]{xcolor}
\usepackage[colorlinks=true, linkcolor=blue!70!black, citecolor=blue!70!black,urlcolor=black,breaklinks=true]{hyperref}
\usepackage{microtype}
\usepackage{hhline}

\makeatletter
\newcommand{\neutralize}[1]{\expandafter\let\csname c@#1\endcsname\count@}
\makeatother

   \newenvironment{lemmod}[2]
  {\renewcommand{\thelemma}{\ref*{#1}#2}%
   \neutralize{lemma}\phantomsection
   \begin{lemma}}
  {\end{lemma}}


\newenvironment{thmmod}[2]
  {\renewcommand{\thetheorem}{\ref*{#1}#2}%
   \neutralize{theorem}\phantomsection
   \begin{theorem}}
  {\end{theorem}}


\newenvironment{bodythmmod}[2]
  {\renewcommand{\thebodytheorem}{\ref*{#1}#2}%
   \neutralize{bodytheorem}\phantomsection
   \begin{theorem}}
  {\end{theorem}}

    \newenvironment{propmod}[2]
  {\renewcommand{\theproposition}{\ref*{#1}#2}%
   \neutralize{proposition}\phantomsection
   \begin{proposition}}
  {\end{proposition}}

     \newenvironment{defnmod}[2]
  {\renewcommand{\thedefinition}{\ref*{#1}#2}%
   \neutralize{definition}\phantomsection
   \begin{definition}}
  {\end{definition}}

   \newenvironment{asmmod}[2]
  {\renewcommand{\theassumption}{\ref*{#1}#2}%
   \neutralize{assumption}\phantomsection
   \begin{assumption}}
  {\end{assumption}}

  \newenvironment{cormod}[2]
  {\renewcommand{\thecorollary}{\ref*{#1}#2}%
   \neutralize{corollary}\phantomsection
   \begin{corollary}}
  {\end{corollary}}
  
   \newenvironment{condmod}[2]
  {\renewcommand{\thecondition}{\ref*{#1}#2}%
   \neutralize{condition}\phantomsection
   \begin{condition}}
  {\end{condition}}


% algorithms
\usepackage{algorithm}
% \usepackage{algpseudocode}

%  \let\oldparagraph\paragraph
%  \renewcommand{\paragraph}[1]{\oldparagraph{#1.}}

\usepackage{natbib}
\bibliographystyle{plainnat}
\bibpunct{(}{)}{;}{a}{,}{,}

\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{amsmath}
\usepackage{bbm}
\usepackage{amsfonts}
\usepackage{amssymb}
% \let\vec\undefined
% \usepackage{MnSymbol} %Actually conflicts with amssymb and others

\usepackage{xpatch}

%%% theorems

\usepackage{thmtools}
\usepackage{thm-restate}
\declaretheorem[name=Theorem,parent=section]{theorem}
\declaretheorem[name=Lemma,parent=section]{lemma}
\declaretheorem[name=Assumption, parent=section]{assumption}
\declaretheorem[name=Condition, parent=section]{condition}
% \declaretheorem[name=Example,style=definition]{example}
% \declaretheorem[qed=$\triangleleft$,name=Example,style=definition, thmbox=S]{example}
\declaretheorem[qed=$\triangleleft$,name=Example,style=definition, parent=section]{example}
\declaretheorem[name=Remark,style=definition, parent=section]{remark}
\declaretheorem[name=Proposition, parent=section]{proposition}
\declaretheorem[name=Fact, parent=section]{fact}

% This needs to come after we include thmtools
\makeatletter
  \renewenvironment{proof}[1][Proof]%
  {%
   \par\noindent{\bfseries\upshape {#1.}\ }%
  }%
  {\qed\newline}
  \makeatother

\theoremstyle{definition}  %Sets style of subsequent newtheorems to 'definition'
\newtheorem{exercise}{Exercise}
\newtheorem{claim}{Claim}
% \newtheorem{lemma}{Lemma}[section]
%\newtheorem{assumption}{Assumption}
\newtheorem{conjecture}{Conjecture}
\newtheorem{corollary}{Corollary}[section]
% \newtheorem{proposition}{Proposition}[section]
% \newtheorem{fact}{Fact}
%\newtheorem{model}{Model}
%\newtheorem{problem}{Problem}
% \newtheorem{assumption}{Assumption}
\newtheorem{problem}{Problem}
\newtheorem{question}{Question}
\newtheorem{model}{Model}

% \newtheorem{examplex}{Example}
% \newenvironment{example}
%   {\pushQED{\qed}\renewcommand{\qedsymbol}{$\triangle$}\examplex}
%   {\popQED\endexamplex}

\theoremstyle{plain}
% \newtheorem{remark}{Remark}
% \newtheorem{example}{Example}
% \newtheorem{theorem}{Theorem}[section]
\newtheorem{definition}{Definition}[section]
\newtheorem{openproblem}{Open Problem}

\xpatchcmd{\proof}{\itshape}{\normalfont\proofnameformat}{}{}
\newcommand{\proofnameformat}{\bfseries}

\newcommand{\notimplies}{\nRightarrow}

%%% prettyref

\usepackage[nameinlink,capitalize]{cleveref}

\newcommand{\pref}[1]{\cref{#1}}
\newcommand{\pfref}[1]{Proof of \pref{#1}}
\newcommand{\savehyperref}[2]{\texorpdfstring{\hyperref[#1]{#2}}{#2}}

\crefformat{equation}{#2(#1)#3}
\Crefformat{equation}{#2(#1)#3}

\crefname{fact}{Fact}{Facts}

\Crefformat{figure}{#2Figure #1#3}
\Crefformat{assumption}{#2Assumption #1#3}

% Fix hyperref in section titles.
\usepackage{crossreftools}
\pdfstringdefDisableCommands{%
    \let\Cref\crtCref
    \let\cref\crtcref
}
\newcommand{\preft}[1]{\crtcref{#1}}


% \usepackage{prettyref}
% \newcommand{\pref}[1]{\prettyref{#1}}
% \newcommand{\pfref}[1]{Proof of \prettyref{#1}}
% \newcommand{\savehyperref}[2]{\texorpdfstring{\hyperref[#1]{#2}}{#2}}
% \newrefformat{eq}{\savehyperref{#1}{\textup{(\ref*{#1})}}}
% \newrefformat{eqn}{\savehyperref{#1}{Equation~\ref*{#1}}}
% \newrefformat{lem}{\savehyperref{#1}{Lemma~\ref*{#1}}}p
% \newrefformat{def}{\savehyperref{#1}{Definition~\ref*{#1}}}
% \newrefformat{line}{\savehyperref{#1}{line~\ref*{#1}}}
% \newrefformat{thm}{\savehyperref{#1}{Theorem~\ref*{#1}}}
% \newrefformat{corr}{\savehyperref{#1}{Corollary~\ref*{#1}}}
% \newrefformat{cor}{\savehyperref{#1}{Corollary~\ref*{#1}}}
% \newrefformat{sec}{\savehyperref{#1}{Section~\ref*{#1}}}
% \newrefformat{app}{\savehyperref{#1}{Appendix~\ref*{#1}}}
% \newrefformat{ass}{\savehyperref{#1}{Assumption~\ref*{#1}}}
% \newrefformat{ex}{\savehyperref{#1}{Example~\ref*{#1}}}
% \newrefformat{fig}{\savehyperref{#1}{Figure~\ref*{#1}}}
% \newrefformat{alg}{\savehyperref{#1}{Algorithm~\ref*{#1}}}
% \newrefformat{rem}{\savehyperref{#1}{Remark~\ref*{#1}}}
% \newrefformat{conj}{\savehyperref{#1}{Conjecture~\ref*{#1}}}
% \newrefformat{prop}{\savehyperref{#1}{Proposition~\ref*{#1}}}
% \newrefformat{proto}{\savehyperref{#1}{Protocol~\ref*{#1}}}
% \newrefformat{prob}{\savehyperref{#1}{Problem~\ref*{#1}}}
% \newrefformat{claim}{\savehyperref{#1}{Claim~\ref*{#1}}}

%  Pro version of declarepaireddelimiter
%  https://tex.stackexchange.com/questions/136749/super-and-subscripts-with-declarepaireddelimiter/136767#136767
\usepackage{xparse}

\ExplSyntaxOn
\DeclareDocumentCommand{\XDeclarePairedDelimiter}{mm}
 {
  \__egreg_delimiter_clear_keys: % reset to the default
  \keys_set:nn { egreg/delimiters } { #2 }
  \use:x % we want to expand the values of the token variables set with the keys
   {
    \exp_not:n {\NewDocumentCommand{#1}{sO{}m} }
     {
      \exp_not:n { \IfBooleanTF{##1} }
       {
        \exp_not:N \egreg_paired_delimiter_expand:nnnn
         { \exp_not:V \l_egreg_delimiter_left_tl }
         { \exp_not:V \l_egreg_delimiter_right_tl }
         { \exp_not:n { ##3 } }
         { \exp_not:V \l_egreg_delimiter_subscript_tl }
       }
       {
        \exp_not:N \egreg_paired_delimiter_fixed:nnnnn 
         { \exp_not:n { ##2 } }
         { \exp_not:V \l_egreg_delimiter_left_tl }
         { \exp_not:V \l_egreg_delimiter_right_tl }
         { \exp_not:n { ##3 } }
         { \exp_not:V \l_egreg_delimiter_subscript_tl }
       }
     }
   }
 }

\keys_define:nn { egreg/delimiters }
 {
  left      .tl_set:N = \l_egreg_delimiter_left_tl,
  right     .tl_set:N = \l_egreg_delimiter_right_tl,
  subscript .tl_set:N = \l_egreg_delimiter_subscript_tl,
 }

\cs_new_protected:Npn \__egreg_delimiter_clear_keys:
 {
  \keys_set:nn { egreg/delimiters } { left=.,right=.,subscript={} }
 }

\cs_new_protected:Npn \egreg_paired_delimiter_expand:nnnn #1 #2 #3 #4
 {% Fix the spacing issue with \left and \right (D. Arsenau, P. Stephani and H. Oberdiek)
  \mathopen{}
  \mathclose\c_group_begin_token
   \left#1
   #3
   \group_insert_after:N \c_group_end_token
   \right#2
   \tl_if_empty:nF {#4} { \c_math_subscript_token {#4} }
 }
\cs_new_protected:Npn \egreg_paired_delimiter_fixed:nnnnn #1 #2 #3 #4 #5
 {
  \mathopen{#1#2}#4\mathclose{#1#3}
  \tl_if_empty:nF {#5} { \c_math_subscript_token {#5} }
 }
\ExplSyntaxOff

% Example
\XDeclarePairedDelimiter{\supnorm}{
  left=\lVert,
  right=\rVert,
  subscript=\infty
  }
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "paper"
%%% End:
